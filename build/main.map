{"version":3,"sources":["webpack:///webpack/bootstrap 19b8cf3e44d7c930df04","webpack:///./node_modules/babel-runtime/regenerator/index.js","webpack:///external \"mongoose\"","webpack:///external \"koa-router\"","webpack:///./server/config/index.js","webpack:///external \"path\"","webpack:///external \"lodash\"","webpack:///external \"ramda\"","webpack:///./server/index.js","webpack:///external \"regenerator-runtime\"","webpack:///external \"koa\"","webpack:///external \"nuxt\"","webpack:///./server/routers/index.js","webpack:///./server/controller/user.js","webpack:///external \"axios\"","webpack:///./server/config ^\\.\\/.*\\.json$","webpack:///./server/config/development.example.json","webpack:///./server/config/development.json","webpack:///./server/config/production.example.json","webpack:///./server/config/production.json","webpack:///external \"axios-mock-adapter\"","webpack:///./server/utils/index.js","webpack:///./server/middleware nonrecursive \\.js$","webpack:///./server/middleware/casbin.js","webpack:///external \"casbin\"","webpack:///./server/middleware/common.js","webpack:///external \"koa-bodyparser\"","webpack:///external \"koa-logger\"","webpack:///external \"koa-session\"","webpack:///external \"@koa/cors\"","webpack:///external \"koa-static\"","webpack:///./server/middleware/database.js","webpack:///external \"fs\"","webpack:///./server/database/plugins/meta.js","webpack:///./server/database/schema \\.js$","webpack:///./server/database/schema/article.js","webpack:///./server/database/schema/articleTag.js","webpack:///./server/database/schema/articleType.js","webpack:///./server/database/schema/user.js","webpack:///external \"bcrypt\"","webpack:///./server/middleware/rest.js","webpack:///./server/middleware/restful/index.js","webpack:///./server/middleware/restful/controller.js","webpack:///./server/middleware/router.js","webpack:///./server/lib/decorator.js","webpack:///./server/lib","webpack:///./nuxt.config.js"],"names":["host","process","env","HOST","conf","require","_","assign","config","port","PORT","MIDDLEWARES","useMiddlewares","context","keys","forEach","filename","getFilename","key","isValid","includes","console","log","R","forEachObjIndexed","initWith","app","err","error","Server","router","use","route","routes","allowedMethods","dev","nuxt","builder","build","ctx","next","status","req","session","Promise","resolve","reject","res","on","render","promise","then","catch","listen","start","get","post","body","mock","onPost","base_url","reply","JSON","parse","data","mobile","userinfo","token","user","ret","msg","login","request","username","password","name","id","code","message","logout","reg","exec","path","Enforcer","BasicAuthorizer","enforcer","originalUrl","method","getUserName","enforce","authz","newEnforcer","Error","authzorizer","checkPermission","initCasbin","addLogger","koaLogger","addStatic","koaStatic","join","__dirname","addCORS","cors","addBody","KoaBody","addSession","CONFIG","maxAge","overwrite","signed","rolling","mongoose","plugin","modelDir","database","set","connect","db","useNewUrlParser","connection","info","User","model","findOne","email","save","ArticleType","find","countDocuments","typeLenght","typeList","insertMany","module","exports","MetaPlugin","schema","options","pre","isNew","meta","createdAt","updatedAt","Date","now","Schema","Types","Mixed","ObjectId","ArticleSchema","title","type","String","required","cover","desc","pubdate","default","content","Number","openness","isTop","Boolean","ref","author","tags","likeList","avatar","userid","commentList","clickNum","virtual","length","virtuals","ArticleTagSchema","ArticleTypeSchema","bcrypt","SALT_WORK_FACTOR","MAX_LOGIN_ATTEMPTS","LOCK_TIME","UserSchema","unique","role","lockUntil","loginAttempts","isModified","genSalt","salt","hash","methods","comparePassword","_password","compare","isMatch","incLoginAttempts","update","$set","$unset","updates","$inc","isLockde","restfulRouter","addRestful","Router","rest","prefix","skipMid","str","skip","params","tab","split","indexOf","getModel","strict","where","query","_where","sort","_sort","parseInt","_skip","limit","_limit","populate","_populate","_regex","RegExp","_lt","$lt","_lte","$lte","_gt","$gt","_gte","$gte","_ne","$ne","success","Model","doc","entity","Route","init","symbolPrefix","Symbol","routeMap","Map","isArray","c","apiPath","regx","filter","test","i","controller","controllers","prefixPath","target","normalizePath","routerPath","startsWith","descriptor","prototype","put","del","all","decorate","args","middleware","unshift","convert","auth","admin","roel","roleExpected","errors","checkRules","value","has","rules","head","charset","hid","link","rel","href","css","src","plugins","ssr","loading","NODE_ENV","cache","max","vendor","extend","client"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 7);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 19b8cf3e44d7c930df04","module.exports = require(\"regenerator-runtime\");\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/babel-runtime/regenerator/index.js\n// module id = 0\n// module chunks = 0","module.exports = require(\"mongoose\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongoose\"\n// module id = 1\n// module chunks = 0","module.exports = require(\"koa-router\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-router\"\n// module id = 2\n// module chunks = 0","import _ from 'lodash'\r\n// import { resolve } from 'path'\r\n\r\nconst host = process.env.HOST || 'localhost'\r\nconst env = process.env.NODE_ENV || 'development'\r\n\r\n// const confPath = resolve(__dirname, `./${env}.json`)\r\n\r\n// 同步加载json配置文件\r\nconst conf = require(`./${env}.json`)\r\n\r\n// 用lodash合并\r\nexport default _.assign({ env, host }, conf)\n\n\n// WEBPACK FOOTER //\n// ./server/config/index.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 4\n// module chunks = 0","module.exports = require(\"lodash\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"lodash\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"ramda\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"ramda\"\n// module id = 6\n// module chunks = 0","import Koa from 'koa'\r\nimport { Nuxt, Builder } from 'nuxt'\r\nimport Router from 'koa-router'\r\nimport route from './routers'\r\nimport R from 'ramda'\r\nimport { getFilename } from './utils'\r\nimport config from './config'\r\n\r\nconst host = config.HOST || process.env.HOST || '0.0.0.0'\r\nconst port = config.PORT || process.env.PORT || 3000\r\n\r\nconst MIDDLEWARES = ['database', 'common', 'rest', 'router']\r\n\r\n// 自动遍历 ./middleware/*.js 导出对象后再逐个遍历初始化koa中间件\r\nconst useMiddlewares = app => {\r\n  // 不递归加载子目录\r\n  const context = require.context('./middleware/', false, /\\.js$/)\r\n\r\n  // R.map(\r\n  //   R.compose(\r\n  //     filename => MIDDLEWARES.includes(filename),\r\n  //     key => getFilename(key)\r\n  //   )\r\n  // )(context.keys())\r\n\r\n  context.keys().forEach(key => {\r\n    const filename = getFilename(key)\r\n    const isValid = MIDDLEWARES.includes(filename)\r\n    if (isValid) {\r\n      console.log('成功加载系统中间件:', filename)\r\n      try {\r\n        R.forEachObjIndexed(initWith => initWith(app))(context(key))\r\n      } catch (err) {\r\n        console.error(err)\r\n      }\r\n    }\r\n  })\r\n}\r\n\r\nclass Server {\r\n  constructor() {\r\n    this.app = new Koa()\r\n    useMiddlewares(this.app)\r\n  }\r\n\r\n  async start(host, port) {\r\n    const router = new Router()\r\n    router.use('', route.routes())\r\n    this.app.use(router.routes()).use(router.allowedMethods())\r\n\r\n    // Import and Set Nuxt.js options\r\n    let config = require('../nuxt.config.js')\r\n    config.dev = !(process.env.NODE_ENV === 'production')\r\n    // console.log('env === ', app.env, env, process.env.COOKIE_DOMAIN, process.env.APP_ENV, config.dev)\r\n\r\n    // Instantiate nuxt.js\r\n    const nuxt = new Nuxt(config)\r\n\r\n    // Build in development\r\n    if (config.dev) {\r\n      const builder = new Builder(nuxt)\r\n      await builder.build()\r\n    }\r\n\r\n    this.app.use(async (ctx, next) => {\r\n      await next()\r\n      ctx.status = 200 // koa defaults to 404 when it sees that status is unset\r\n      ctx.req.session = ctx.session // 必须将session添加进request中，否则nuxt的req获取不到session\r\n      return new Promise((resolve, reject) => {\r\n        ctx.res.on('close', resolve)\r\n        ctx.res.on('finish', resolve)\r\n        nuxt.render(ctx.req, ctx.res, promise => {\r\n          // nuxt.render passes a rejected promise into callback on error.\r\n          promise.then(resolve).catch(reject)\r\n        })\r\n      })\r\n    })\r\n\r\n    this.app.listen(port, host)\r\n    console.log('Server listening on http://' + host + ':' + port) // eslint-disable-line no-console\r\n  }\r\n}\r\n\r\ntry {\r\n  const app = new Server()\r\n  app.start(host, port)\r\n} catch (err) {\r\n  console.error(err)\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"regenerator-runtime\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"regenerator-runtime\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"koa\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa\"\n// module id = 9\n// module chunks = 0","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 10\n// module chunks = 0","import Router from 'koa-router'\r\nimport { userinfo, login, logout } from '../controller/user'\r\nconst router = new Router()\r\n\r\nrouter.get('/api/user', userinfo)\r\nrouter.post('/api/login', login)\r\nrouter.post('/api/logout', logout)\r\nrouter.get('/api/logout', logout)\r\n\r\nrouter.get('/api/test', ctx => ctx.body = 'jerry')\r\n\r\nexport default router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/routers/index.js","// import { admin } from '../service'\r\nimport axios from 'axios'\r\nimport config from '../config'\r\nimport MockAdapter from 'axios-mock-adapter'\r\nvar mock = new MockAdapter(axios)\r\nmock.onPost(config.base_url + '/api/v1.user/login').reply(function (config) {\r\n  // console.log(JSON.parse(config.data).mobile)\r\n  return [\r\n    200,\r\n    {'ret': 200, 'msg': '请求成功', 'data': {'code': 0, 'message': '登录成功', 'token': 'PhU0Sd9zwUSwOQgXnJpj7pgSwdA7YD80', 'id': 1, 'mobile': '13770267077', 'name': JSON.parse(config.data).mobile, 'sex': 1, 'status': 1, 'role_id': 1, 'depart_id': 1, 'leader_id': 0}}\r\n  ]\r\n})\r\n\r\nexport const userinfo = async (ctx, next) => {\r\n  let token = ctx.session.user && ctx.session.user.token || ''\r\n  return (ctx.body = {\r\n    ret: 200,\r\n    msg: '获取成功',\r\n    data: { token: token || null }\r\n  })\r\n}\r\n\r\nexport const login = async (ctx, next) => {\r\n  const { username, password} = ctx.request.body\r\n  if (!username || !password) {\r\n    return (ctx.body = {\r\n      ret: 303,\r\n      msg: '缺少请求参数',\r\n      data: {}\r\n    })\r\n  }\r\n\r\n  // // 发起请求\r\n  // let _url = config.base_url + '/api/v1.user/login'\r\n  // let req = await axios.post(_url, {\r\n  //   mobile: mobile,\r\n  //   psd: psd,\r\n  //   sign: ''\r\n  // })\r\n  // // 网络异常\r\n  // if (req.status !== 200) {\r\n  //   return (ctx.body = {\r\n  //     ret: 400,\r\n  //     msg: '网络通讯异常',\r\n  //     data: {}\r\n  //   })\r\n  // }\r\n  // // 系统异常\r\n  // if (req.data.ret !== 200) {\r\n  //   let ret = req.data.ret || 400\r\n  //   let msg = req.data.msg || '失败'\r\n  //   return (ctx.body = {\r\n  //     ret: ret,\r\n  //     msg: msg,\r\n  //     data: {}\r\n  //   })\r\n  // }\r\n\r\n  // // 登陆失败\r\n  // if (req.data.data.code !== 0) {\r\n  //   let code = req.data.data.code || -1\r\n  //   let message = req.data.data.message || '登录失败'\r\n  //   return (ctx.body = {\r\n  //     ret: 200,\r\n  //     msg: '请求成功',\r\n  //     data: {\r\n  //       code: code,\r\n  //       message: message\r\n  //     }\r\n  //   })\r\n  // }\r\n\r\n  // 登陆成功\r\n  // let token = req.data.data.token\r\n  // let signkey = config.sign_key\r\n\r\n  // let info = {\r\n  //   id: req.data.data.id,\r\n  //   mobile: req.data.data.mobile,\r\n  //   name: req.data.data.name,\r\n  //   sex: req.data.data.sex,\r\n  //   status: req.data.data.status,\r\n  //   role_id: req.data.data.role_id,\r\n  //   depart_id: req.data.data.depart_id,\r\n  //   deader_id: req.data.data.deader_id\r\n  // }\r\n\r\n  // let session = ctx.session\r\n  // session.user = {\r\n  //   token: token,\r\n  //   sign_key: signkey,\r\n  //   info: info\r\n  // }\r\n\r\n  // const isValid = await admin.login(username, password)\r\n  console.log('isValid, username, password', isValid, username, password)\r\n  \r\n  let session = {}, token = 'PhU0Sd9zwUSwOQgXnJpj7pgSwdA7YD80'\r\n  session.user = {\r\n    token,\r\n    username,\r\n    name: username,\r\n    mobile: username,\r\n    id: '444'\r\n  }\r\n\r\n  ctx.session = session\r\n\r\n  return (ctx.body = {\r\n    ret: 200,\r\n    msg: '请求成功',\r\n    data: {\r\n      code: 0,\r\n      message: '登录成功',\r\n      token\r\n    }\r\n  })\r\n}\r\n\r\nexport const logout = async (ctx, next) => {\r\n  try {\r\n    ctx.session.user = null\r\n    return (ctx.body = {\r\n      ret: 200,\r\n      msg: '请求成功',\r\n      data: {\r\n        code: 0,\r\n        message: '退出成功'\r\n      }\r\n    })\r\n  } catch (e) {\r\n    return (ctx.body = {\r\n      ret: 200,\r\n      msg: '请求成功',\r\n      data: {\r\n        code: -1,\r\n        message: '退出失败'\r\n      }\r\n    })\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/controller/user.js","module.exports = require(\"axios\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios\"\n// module id = 13\n// module chunks = 0","var map = {\n\t\"./development.example.json\": 15,\n\t\"./development.json\": 16,\n\t\"./production.example.json\": 17,\n\t\"./production.json\": 18\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 14;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config ^\\.\\/.*\\.json$\n// module id = 14\n// module chunks = 0","module.exports = {\"db\":\"mongodb://localhost:27017/jerryServ\",\"SITE_ROOT_URL\":\"http://jj.jerryshi.com\",\"qiniu\":{\"AK\":\"\",\"SK\":\"\",\"bucket\":\"\",\"qiniuURL\":\"\",\"config\":{\"useCdnDomain\":true}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/development.example.json\n// module id = 15\n// module chunks = 0","module.exports = {\"db\":\"mongodb://localhost:27017/jerryServ\",\"SITE_ROOT_URL\":\"http://jj.jerryshi.com\",\"qiniu\":{\"AK\":\"\",\"SK\":\"\",\"bucket\":\"\",\"qiniuURL\":\"\",\"config\":{\"useCdnDomain\":true}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/development.json\n// module id = 16\n// module chunks = 0","module.exports = {\"db\":\"mongodb://localhost/jerryServ\",\"SITE_ROOT_URL\":\"http://jj.jerryshi.com\",\"qiniu\":{\"AK\":\"\",\"SK\":\"\",\"bucket\":\"\",\"qiniuURL\":\"\",\"config\":{\"useCdnDomain\":true}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/production.example.json\n// module id = 17\n// module chunks = 0","module.exports = {\"HOST\":\"0.0.0.0\",\"PORT\":3003,\"db\":\"mongodb://localhost:27017/jerryServ\",\"SITE_ROOT_URL\":\"http://jj.jerryshi.com\",\"qiniu\":{\"AK\":\"OiUlP0RxLh1eN318uvFvX4AyHeRfAGOiPmnNwdGx\",\"SK\":\"Meii5goUxxczCkctM3vM3dgdQTU5r7YwOzHeIocE\",\"bucket\":\"myblog\",\"qiniuURL\":\"http://cdn.jerryshi.com/\",\"config\":{\"useCdnDomain\":true}}}\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/config/production.json\n// module id = 18\n// module chunks = 0","module.exports = require(\"axios-mock-adapter\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"axios-mock-adapter\"\n// module id = 19\n// module chunks = 0","export const getFilename = path => {\r\n  const reg = /\\/(\\w+).js$/\r\n  const res = reg.exec(path)\r\n  return res && res[1]\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/utils/index.js","var map = {\n\t\"./casbin.js\": 22,\n\t\"./common.js\": 24,\n\t\"./database.js\": 30,\n\t\"./rest.js\": 39,\n\t\"./router.js\": 42\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 21;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/middleware nonrecursive \\.js$\n// module id = 21\n// module chunks = 0","const { Enforcer } = require('casbin')\r\n\r\n// BasicAuthorizer class stores the casbin handler\r\nclass BasicAuthorizer {\r\n  constructor(ctx, enforcer) {\r\n    this.ctx = ctx\r\n    this.enforcer = enforcer\r\n  }\r\n\r\n  // getUserName gets the user name from the request.\r\n  // Currently, only HTTP basic authentication is supported\r\n  getUserName() {\r\n    // customize to get username from context\r\n    const { user } = this.ctx\r\n    const { username } = user\r\n    return username\r\n  }\r\n\r\n  // checkPermission checks the user/method/path combination from the request.\r\n  // Returns true (permission granted) or false (permission forbidden)\r\n  checkPermission() {\r\n    const { ctx, enforcer } = this\r\n    const { originalUrl: path, method } = ctx\r\n    const user = this.getUserName()\r\n    return enforcer.enforce(user, path, method)\r\n  }\r\n}\r\n\r\n// authz returns the authorizer, uses a Casbin enforcer as input\r\nfunction authz(newEnforcer) {\r\n  return async (ctx, next) => {\r\n    try {\r\n      const enforcer = await newEnforcer()\r\n      if (!(enforcer instanceof Enforcer)) {\r\n        throw new Error('Invalid enforcer')\r\n      }\r\n      const authzorizer = new BasicAuthorizer(ctx, enforcer)\r\n      if (!authzorizer.checkPermission()) {\r\n        ctx.status = 403\r\n      }\r\n      await next()\r\n    } catch (e) {\r\n      throw e\r\n    }\r\n  }\r\n}\r\n\r\nexport const initCasbin = app => {\r\n  // use authz middleware\r\n  app.use(authz(async () => {\r\n    // load the casbin model and policy from files, database is also supported.\r\n    const enforcer = await Enforcer.newEnforcer(\"authz_model.conf\", \"authz_policy.csv\")\r\n    return enforcer\r\n  }))\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/casbin.js","module.exports = require(\"casbin\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"casbin\"\n// module id = 23\n// module chunks = 0","import KoaBody from 'koa-bodyparser'\r\nimport koaLogger from 'koa-logger'\r\nimport session from 'koa-session'\r\nimport cors from '@koa/cors'\r\nimport koaStatic from 'koa-static'\r\nimport path from 'path'\r\n\r\nexport const addLogger = app => {\r\n  app.use(koaLogger())\r\n}\r\n\r\nexport const addStatic = app => {\r\n  // 配置静态资源加载中间件\r\n  app.use(koaStatic(path.join(__dirname, '../static')))\r\n}\r\n\r\nexport const addCORS = app => {\r\n  app.use(cors())\r\n}\r\n\r\nexport const addBody = app => {\r\n  app.use(KoaBody())\r\n}\r\n\r\nexport const addSession = app => {\r\n  app.keys = ['ice']\r\n\r\n  const CONFIG = {\r\n    key: 'koa:sess',\r\n    maxAge: 86400000,\r\n    overwrite: true,\r\n    signed: true,\r\n    rolling: false\r\n  }\r\n  app.use(session(CONFIG, app))\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/common.js","module.exports = require(\"koa-bodyparser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-bodyparser\"\n// module id = 25\n// module chunks = 0","module.exports = require(\"koa-logger\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-logger\"\n// module id = 26\n// module chunks = 0","module.exports = require(\"koa-session\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-session\"\n// module id = 27\n// module chunks = 0","module.exports = require(\"@koa/cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"@koa/cors\"\n// module id = 28\n// module chunks = 0","module.exports = require(\"koa-static\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"koa-static\"\n// module id = 29\n// module chunks = 0","import fs from 'fs'\r\nimport { resolve } from 'path'\r\nimport mongoose from 'mongoose'\r\nimport config from '../config'\r\n\r\n// loading mogoose \"meta\" plugins\r\nmongoose.plugin(require('../database/plugins/meta'))\r\n\r\nconst modelDir = resolve(__dirname, '../database/schema')\r\n\r\n// fs\r\n//   .readdirSync(modelDir)\r\n//   .filter(file => ~file.search(/\\.js$/))    // only .js file\r\n//   .forEach(file => require(resolve(modelDir, file)))\r\n\r\nconst context = require.context('../database/schema', true, /\\.js$/)\r\ncontext.keys().forEach(key => context(key))\r\n\r\nexport const database = app => {\r\n  mongoose.set('debug', true)\r\n\r\n  mongoose.connect(config.db, { useNewUrlParser: true })\r\n\r\n  mongoose.connection.on('disconnected', () => {\r\n    mongoose.connect(config.db)\r\n  })\r\n\r\n  mongoose.connection.on('error', err => {\r\n    console.error(err)\r\n  })\r\n\r\n  mongoose.connection.on('open', async () => {\r\n    console.info('Connected to MongoDB ', config.db)\r\n\r\n    // TODO: \r\n    const User = mongoose.model('User')\r\n    let user = await User.findOne({\r\n      username: 'admin'\r\n    }).exec()\r\n\r\n    if (!user) {\r\n      user = new User({\r\n        username: 'admin',\r\n        password: 'admin888',\r\n        email: 'admin@126.com'\r\n      })\r\n      console.info('[Info] 写入管理员数据初始化数据')\r\n    }\r\n    await user.save()\r\n\r\n    ////////////////\r\n    const ArticleType = mongoose.model('ArticleType')\r\n    const typeLenght = await ArticleType.find().countDocuments().exec()\r\n\r\n    if (typeLenght === 0) {\r\n      let typeList = [\r\n        {\r\n          name: '产业职教'\r\n        },\r\n        {\r\n          name: '校企合作'\r\n        },\r\n        {\r\n          name: '校园安全'\r\n        },\r\n        {\r\n          name: '资源干货'\r\n        },\r\n        {\r\n          name: '集团新闻'\r\n        },\r\n        {\r\n          name: '选学校'\r\n        },\r\n        {\r\n          name: '选企业'\r\n        },\r\n        {\r\n          name: '化育明珠'\r\n        },\r\n        {\r\n          name: '现代课堂'\r\n        }\r\n      ]\r\n      await ArticleType.insertMany(typeList)\r\n      console.info('[Info] 写入ArticleType初始化数据')\r\n    }\r\n  })\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/database.js","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 31\n// module chunks = 0","module.exports = exports = function MetaPlugin(schema, options) {\r\n  // 完全就是连锁反应 subDocument也会触发这个中间件!\r\n  schema.pre('save', function (next) {\r\n    if (this.isNew) {\r\n      this.meta = {} // 不能给访问undefined的属性\r\n      this.meta.createdAt = this.meta.updatedAt = Date.now()\r\n    } else {\r\n      // find 也会执行\r\n      this.meta.updatedAt = Date.now()\r\n    }\r\n\r\n    next()\r\n  })\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/plugins/meta.js","var map = {\n\t\"./article.js\": 34,\n\t\"./articleTag.js\": 35,\n\t\"./articleType.js\": 36,\n\t\"./user.js\": 37\n};\nfunction webpackContext(req) {\n\treturn __webpack_require__(webpackContextResolve(req));\n};\nfunction webpackContextResolve(req) {\n\tvar id = map[req];\n\tif(!(id + 1)) // check for number or string\n\t\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n\treturn id;\n};\nwebpackContext.keys = function webpackContextKeys() {\n\treturn Object.keys(map);\n};\nwebpackContext.resolve = webpackContextResolve;\nmodule.exports = webpackContext;\nwebpackContext.id = 33;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/database/schema \\.js$\n// module id = 33\n// module chunks = 0","const mongoose = require('mongoose')\r\nconst Schema = mongoose.Schema\r\nconst { Mixed, ObjectId } = Schema.Types\r\n\r\nconst ArticleSchema = new Schema({\r\n  title: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  cover: String,\r\n  desc: String,\r\n  pubdate: {\r\n    type: Date,\r\n    default: Date.now()\r\n  },\r\n  content: String,\r\n  status: Number,\r\n  openness: String,\r\n  isTop: Boolean,\r\n  password: String,\r\n  type: {\r\n    type: ObjectId,\r\n    ref: 'ArticleType'\r\n  },\r\n  author: {\r\n    type: ObjectId,\r\n    ref: 'User'\r\n  },\r\n  tags: [\r\n    {\r\n      type: ObjectId,\r\n      ref: 'ArticleTag'\r\n    }\r\n  ],\r\n  likeList: [\r\n    {\r\n      username: String,\r\n      avatar: String,\r\n      userid: String,\r\n      meta: {\r\n        createdAt: {\r\n          type: Date,\r\n          default: Date.now()\r\n        },\r\n        updatedAt: {\r\n          type: Date,\r\n          default: Date.now()\r\n        }\r\n      }\r\n    }\r\n  ],\r\n  commentList: [\r\n    {\r\n      username: String,\r\n      avatar: String,\r\n      userid: String,\r\n      content: String,\r\n      meta: {\r\n        createdAt: {\r\n          type: Date,\r\n          default: Date.now()\r\n        },\r\n        updatedAt: {\r\n          type: Date,\r\n          default: Date.now()\r\n        }\r\n      }\r\n    }\r\n  ],\r\n  clickNum: {\r\n    type: Number,\r\n    default: 0\r\n  },\r\n  meta: {\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    },\r\n    updatedAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    }\r\n  }\r\n})\r\n\r\nArticleSchema.virtual('likeNum').get(function () {\r\n  return this.likeList.length || 0\r\n})\r\n\r\nArticleSchema.virtual('commentNum').get(function () {\r\n  return this.commentList.length || 0\r\n})\r\n\r\nArticleSchema.set('toJSON', { virtuals: true })\r\nArticleSchema.set('toObject', { virtuals: true })\r\n\r\n// ArticleSchema.pre('find', function (next) {\r\n//   console.log('我是pre方法1')\r\n//   console.log(this)\r\n//   next()\r\n// })\r\n\r\nmongoose.model('Article', ArticleSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/article.js","const mongoose = require('mongoose')\r\nconst Schema = mongoose.Schema\r\n\r\nconst ArticleTagSchema = new Schema({\r\n  name: {\r\n    type: String,\r\n    required: true \r\n  },\r\n  desc: String,\r\n  meta: {\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    },\r\n    updatedAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    }\r\n  }\r\n})\r\n\r\nmongoose.model('ArticleTag', ArticleTagSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/articleTag.js","const mongoose = require('mongoose')\r\nconst Schema = mongoose.Schema\r\n\r\nconst ArticleTypeSchema = new Schema({\r\n  name: {\r\n    type: String,\r\n    required: true \r\n  },\r\n  desc: String,\r\n  meta: {\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    },\r\n    updatedAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    }\r\n  }\r\n})\r\n\r\nmongoose.model('ArticleType', ArticleTypeSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/articleType.js","const mongoose = require('mongoose')\r\nconst bcrypt = require('bcrypt')\r\nconst Schema = mongoose.Schema\r\n\r\nconst SALT_WORK_FACTOR = 10\r\nconst MAX_LOGIN_ATTEMPTS = 5\r\nconst LOCK_TIME = 2 * 60 * 60 * 1000\r\n\r\nconst UserSchema = new Schema({\r\n  username: {\r\n    unique: true,\r\n    required: true,\r\n    type: String\r\n  },\r\n  email: {\r\n    unique: true,\r\n    required: true,\r\n    type: String\r\n  },\r\n  password: {\r\n    type: String,\r\n    required: true\r\n  },\r\n  avatar: {\r\n    type: String,\r\n    default: 'http://cdn.jerryshi.com/picgo/20180819213615.png'\r\n  },\r\n  role: {\r\n    type: String,\r\n    default: 'user'\r\n  },\r\n  lockUntil: Number,\r\n  loginAttempts: {\r\n    type: Number,\r\n    required: true,\r\n    default: 0\r\n  },\r\n  meta: {\r\n    createdAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    },\r\n    updatedAt: {\r\n      type: Date,\r\n      default: Date.now()\r\n    }\r\n  }\r\n})\r\n\r\nUserSchema.virtual('isLocked').get(function () {\r\n  return !!(this.lockUntil && this.lockUntil > Date.now())  // 取两次反转boolean\r\n})\r\n\r\nUserSchema.pre('save', function (next) {\r\n  if (!this.isModified('password')) return next()\r\n\r\n  // 使用第三方库构建盐\r\n  bcrypt.genSalt(SALT_WORK_FACTOR, (err, salt) => {\r\n    // 如果构建盐失败返回\r\n    if (err) return next(err)\r\n    // 尝试用盐加密\r\n    bcrypt.hash(this.password, salt, (error, hash) => {\r\n      // 加密失败抛出去\r\n      if (error) return next(err)\r\n\r\n      this.password = hash\r\n      // 交出控制权\r\n      next()\r\n    })\r\n  })\r\n})\r\n\r\nUserSchema.methods = {\r\n  // _password为网站提交来的明文password，第二个就是数据库中加盐后的hash密码\r\n  comparePassword: (_password, password) => {\r\n    return new Promise((resolve, reject) => {\r\n      bcrypt.compare(_password, password, (err, isMatch) => {\r\n        if (!err) resolve(isMatch)\r\n        else reject(err)\r\n      })\r\n    })\r\n  },\r\n\r\n  incLoginAttempts: (user) => {\r\n    return new Promise((resolve, reject) => {\r\n      if (this.lockUntil && this.lockUntil < Date.now()) {\r\n        this.update({\r\n          $set: {  // 原来mongoose的$set+$unset就是个原子操作\r\n            loginAttempts: 1\r\n          },\r\n          $unset: {\r\n            lockUntil: 1\r\n          }\r\n        }, (err) => {\r\n          if (!err) resolve(true)\r\n          else reject(err)\r\n        })\r\n      } else {\r\n        let updates = {\r\n          $inc: {\r\n            loginAttempts: 1\r\n          }\r\n        }\r\n\r\n        if (this.loginAttempts + 1 >= MAX_LOGIN_ATTEMPTS && !this.isLockde) {\r\n          updates.$set = {\r\n            lockUntil: Date.now() + LOCK_TIME\r\n          }\r\n        }\r\n\r\n        this.update(updates, err => {\r\n          if (!err) resolve(true)\r\n          else reject(err)\r\n        })\r\n      }\r\n    })\r\n  }\r\n}\r\n\r\nmongoose.model('User', UserSchema)\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/database/schema/user.js","module.exports = require(\"bcrypt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"bcrypt\"\n// module id = 38\n// module chunks = 0","const restfulRouter = require('./restful')\r\n\r\nexport const addRestful = app => {\r\n  app.use(restfulRouter.routes()).use(restfulRouter.allowedMethods())\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/rest.js","const Router = require('koa-router')\r\nconst rest = require('./controller')\r\n\r\nconst router = new Router({ prefix: '/autoapi' })\r\n\r\nfunction skipMid(ctx, next, str) {\r\n  //是否设置跳过\r\n  if (!router.skip || !router.skip[ctx.params.tab]) {\r\n    return false\r\n  }\r\n  //是否全部跳过\r\n  if (router.skip[ctx.params.tab] == 'ALL') {\r\n    next()\r\n    return true\r\n  }\r\n  //是否跳过一个\r\n  if (router.skip[ctx.params.tab].split(',').indexOf(str) >= 0) {\r\n    next()\r\n    return true\r\n  }\r\n  return false\r\n}\r\n\r\nrouter\r\n  .get('/:tab', rest.get)\r\n  .post('/:tab', rest.post)\r\n\r\n// router.get('/:tab', (ctx, next) => {\r\n//   if (skipMid(ctx, next, 'GET')) {\r\n//     return\r\n//   }\r\n//   console.log('进来了', skipMid(ctx, next, 'GET'))\r\n//   rest.get(ctx, next)\r\n// })\r\n\r\n// router.use('/:tab').get(function(ctx, next) {\r\n//   if (skipMid(ctx, next, 'GET')) {\r\n//     return\r\n//   }\r\n//   rest.get(ctx, next)\r\n// })\r\n\r\n// rest.skip = {\r\n//   'user': 'fetchID'  // 跳过对user资源的fetchID请求\r\n// }\r\n\r\nmodule.exports = router\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/restful/index.js","const mongoose = require('mongoose')\r\nconst Schema = mongoose.Schema\r\n\r\nconst getModel = function (tab) {\r\n  let model\r\n  try {\r\n    model = mongoose.model(tab)\r\n  } catch (error) {\r\n    model = mongoose.model(tab, new Schema({}, { strict: false }))\r\n  }\r\n  return model\r\n}\r\n\r\nexport const get = async (ctx, next) => {\r\n  let where = ctx.query._where\r\n  const sort = ctx.query._sort || {}\r\n  const skip = parseInt(ctx.query._skip, 10) || 0\r\n  const limit = parseInt(ctx.query._limit, 10) || 100\r\n  const populate = ctx.query._populate || ''\r\n  if (where) {\r\n    where = JSON.parse(where)\r\n    for (var key in where) {\r\n      if (where[key]._regex) {\r\n        where[key] = new RegExp(where[key]._regex)\r\n      }\r\n      if (where[key]._lt) {\r\n        where[key].$lt = where[key]._lt\r\n        delete where[key]._lt\r\n      }\r\n      if (where[key]._lte) {\r\n        where[key].$lte = where[key]._lte\r\n        delete where[key]._lte\r\n      }\r\n      if (where[key]._gt) {\r\n        where[key].$gt = where[key]._gt\r\n        delete where[key]._gt\r\n      }\r\n      if (where[key]._gte) {\r\n        where[key].$gte = where[key]._gte\r\n        delete where[key]._gte\r\n      }\r\n      if (where[key]._ne) {\r\n        where[key].$ne = where[key]._ne\r\n        delete where[key]._ne\r\n      }\r\n    }\r\n  }\r\n  console.log(populate)\r\n  //查询 - 根据：tab\r\n  const data = await getModel(ctx.params.tab)\r\n    .find(where)\r\n    .sort(sort)\r\n    .skip(skip)\r\n    .limit(limit)\r\n    .populate(populate)\r\n    .exec()\r\n\r\n  ctx.body = ({\r\n    success: 'true',\r\n    data\r\n  })\r\n}\r\n\r\nexport const post = async function (ctx, next) {\r\n  const Model = getModel(req.params.tab)\r\n  const doc = ctx.request.body\r\n  const entity = new Model(doc)\r\n  const data = await entity.save()\r\n  ctx.body = {\r\n    success: true,\r\n    data\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/restful/controller.js","const { Route } = require('../lib/decorator')\r\n// const { resolve } = require('path')\r\n// 只要执行此中间件，就等于执行了整个路由中间层\r\nexport const router = app => {\r\n  // const apiPath = resolve(__dirname, '../routes')\r\n  // Todo: 待修复，现在只能传相对路径，且字符串\r\n  const router = new Route(app, '../routes')\r\n\r\n  router.init()\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/middleware/router.js","const Router = require('koa-router')\r\nconst { resolve } = require('path')\r\n// const glob = require('glob')\r\nconst _ = require('lodash')\r\nconst R = require('ramda')\r\n\r\nconst symbolPrefix = Symbol('prefix')\r\nconst routeMap = new Map()\r\n\r\nconst isArray = c => _.isArray(c) ? c : [c]\r\n\r\nexport class Route {\r\n  constructor(app, apiPath) {\r\n    this.app = app\r\n    this.apiPath = apiPath\r\n    this.router = new Router()\r\n  }\r\n\r\n  init() {\r\n    const regx = /^\\.\\/public\\//    // 过滤public目录下的公共路由\r\n    // glob.sync(resolve(this.apiPath, './**/*.js')).forEach(require)\r\n    // Todo: 待修复require.context不支持绝对路径问题\r\n    const context = require.context(`${this.apiPath}`, true, /\\.js$/)\r\n    console.log(context.keys().filter(i => !regx.test(i)))\r\n    context.keys().forEach(key => context(key))\r\n    \r\n    // 为所有中间件注册路由\r\n    for (let [conf, controller] of routeMap) {\r\n      const controllers = isArray(controller)\r\n      const prefixPath = conf.target[symbolPrefix]\r\n      if (prefixPath) prefixPath = normalizePath(prefixPath)\r\n      const routerPath = prefixPath + conf.path\r\n      this.router[conf.method](routerPath, ...controllers)\r\n    }\r\n\r\n    this.app.use(this.router.routes()).use(this.router.allowedMethods())\r\n  }\r\n}\r\n\r\n// 如果是根路径就直接访问，如果不是就接着访问\r\nconst normalizePath = path => path.startsWith('/') ? path : `/${path}`\r\n\r\nconst router = conf => (target, key, descriptor) => {\r\n  conf.path = normalizePath(conf.path)\r\n\r\n  routeMap.set({\r\n    target,\r\n    ...conf\r\n  }, target[key])\r\n\r\n}\r\n\r\n// export 利用symbol创建唯一值在类的原型上\r\nexport const controller = path => target => (target.prototype[symbolPrefix] = path)\r\n\r\nexport const get = path => router({\r\n  method: 'get',\r\n  path\r\n})\r\n\r\nexport const post = path => router({\r\n  method: 'post',\r\n  path\r\n})\r\n\r\nexport const put = path => router({\r\n  method: 'put',\r\n  path\r\n})\r\n\r\nexport const del = path => router({\r\n  method: 'delete',\r\n  path\r\n})\r\n\r\nexport const use = path => router({\r\n  method: 'use',\r\n  path\r\n})\r\n\r\nexport const all = path => router({\r\n  method: 'all',\r\n  path\r\n})\r\n\r\nconst decorate = (args, middleware) => {\r\n  let [target, key, descriptor] = args\r\n\r\n  target[key] = isArray(target[key])\r\n  target[key].unshift(middleware)\r\n\r\n  return descriptor\r\n}\r\n\r\nconst convert = middleware => (...args) => decorate(args, middleware)\r\n\r\n// const changeToArr = R.unless(\r\n//   R.is(isArray),\r\n//   R.of\r\n// )\r\n\r\n// const convert = middleware => (target, key, descriptor) => {\r\n//   return (target, key, descriptor) => {\r\n//     target[key] = R.compose(\r\n//       R.concat(\r\n//         changeToArr(middleware)\r\n//       ),\r\n//       changeToArr\r\n//     )(target[key])\r\n//   }\r\n// }\r\n\r\nexport const auth = convert(async (ctx, next) => {\r\n  console.log('进来auth装饰器了咩？')\r\n  if (!!!ctx.session || !ctx.session.user) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      code: 401,\r\n      err: '登录失效，重新登录'\r\n    })\r\n  }\r\n\r\n  await next()\r\n})\r\n\r\nexport const admin = roleExpected => convert(async (ctx, next) => {\r\n  const { role } = ctx.session.user\r\n\r\n  //Todo: casbin\r\n\r\n  if (!roel || role !== roleExpected) {\r\n    return (ctx.body = {\r\n      success: false,\r\n      code: 403,\r\n      err: '无权限'\r\n    })\r\n  }\r\n\r\n  await next()\r\n})\r\n\r\nexport const required = rules => convert(async (ctx, next) => {\r\n  let errors = []\r\n\r\n  const checkRules = R.forEachObjIndexed(\r\n    (value, key) => {\r\n      errors = R.filter(i => !R.has(i)(ctx.request[key]))(value)\r\n    }\r\n  )\r\n\r\n  checkRules(rules)\r\n\r\n  if (errors.length) {\r\n    return (\r\n      ctx.body = {\r\n        success: false,\r\n        code: 412,\r\n        err: `${errors.join(',')} is required`\r\n      }\r\n    )\r\n  }\r\n\r\n  await next()\r\n})\r\n\r\n\n\n\n// WEBPACK FOOTER //\n// ./server/lib/decorator.js","function webpackEmptyContext(req) {\n\tthrow new Error(\"Cannot find module '\" + req + \"'.\");\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 44;\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./server/lib\n// module id = 44\n// module chunks = 0","module.exports = {\r\n  /*\r\n  ** Headers of the page\r\n  */\r\n  head: {\r\n    title: 'nuxt-temp',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { hid: 'description', name: 'description', content: 'Nuxt.js project' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' },\r\n      { rel: 'stylesheet', name: 'iview', href: '/styles/iview.css' },\r\n      { rel: 'stylesheet', name: 'theme', href: '' }\r\n    ]\r\n  },\r\n  css: [\r\n    { src: '~assets/css/main.css' },\r\n    'quill/dist/quill.snow.css',\r\n    'quill/dist/quill.bubble.css',\r\n    'quill/dist/quill.core.css'\r\n    // { src: 'iview/dist/styles/iview.css' }\r\n  ],\r\n  plugins: [\r\n    { src: '~plugins/flexible.js', ssr: false },\r\n    { src: '~plugins/iview.js', ssr: true },\r\n    { src: '~/plugins/quillEditor.js', ssr: false }\r\n  ],\r\n  loading: './components/loading.vue',\r\n  env: {\r\n    NODE_ENV: process.env.NODE_ENV || 'prodev'\r\n  },\r\n  cache: {\r\n    max: 1000,\r\n    maxAge: 900000\r\n  },\r\n  router: {\r\n    middleware: 'route' // 在每页渲染前运行 middleware/route.js 中间件的逻辑\r\n  },\r\n  build: {\r\n    // babel: {  // 前端不需要修饰器，后端才要\r\n    //   plugins: ['babel-plugin-transform-decorators-legacy']\r\n    // },\r\n    vendor: ['axios', 'iview', './plugins/iview.js'],\r\n    extend(config, ctx) {\r\n      // if (ctx.isClient) {\r\n      if (process.client) {\r\n        // config.module.rules.push({\r\n        //   enforce: 'pre',\r\n        //   test: /\\.(js|vue)$/,\r\n        //   loader: 'eslint-loader',\r\n        //   exclude: /(node_modules)/\r\n        // })\r\n      }\r\n    }\r\n  }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}